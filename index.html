     1	<!DOCTYPE html>
     2	<html lang="ja">
     3	<head>
     4	    <meta charset="UTF-8">
     5	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     6	    <title>è‹±èªè¾æ›¸ã‚¢ãƒ—ãƒª</title>
     7	    <script src="https://cdn.tailwindcss.com"></script>
     8	    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
     9	    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    10	    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    11	    <style>
    12	        .clickable-word { 
    13	            cursor: pointer; 
    14	            color: blue; 
    15	            text-decoration: underline;
    16	            padding: 2px 4px;
    17	            border-radius: 4px;
    18	        }
    19	        .clickable-word:hover { 
    20	            background-color: yellow; 
    21	        }
    22	        #dictionary-popup {
    23	            z-index: 9999;
    24	        }
    25	    </style>
    26	</head>
    27	<body class="bg-gray-100">
    28	    <div class="max-w-4xl mx-auto p-8">
    29	        <h1 class="text-3xl font-bold text-gray-800 mb-6">
    30	            <i class="fas fa-book mr-2"></i>
    31	            è‹±èªè¾æ›¸ã‚¢ãƒ—ãƒª
    32	        </h1>
    33	
    34	        <!-- ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    35	        <div class="flex border-b mb-6">
    36	            <button id="file-tab" class="px-4 py-2 border-b-2 border-blue-500 text-blue-600 bg-blue-50 font-medium">
    37	                <i class="fas fa-upload mr-2"></i>ãƒ•ã‚¡ã‚¤ãƒ«
    38	            </button>
    39	            <button id="text-tab" class="px-4 py-2 border-b-2 border-transparent text-gray-500 font-medium">
    40	                <i class="fas fa-edit mr-2"></i>ãƒ†ã‚­ã‚¹ãƒˆ
    41	            </button>
    42	        </div>
    43	
    44	        <!-- ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚¨ãƒªã‚¢ -->
    45	        <div id="file-input-area" class="mb-6">
    46	            <!-- ã‚¹ãƒãƒ›ç”¨ãƒœã‚¿ãƒ³ -->
    47	            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    48	                <button id="camera-btn" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg transition-colors font-medium flex items-center justify-center space-x-2">
    49	                    <i class="fas fa-camera text-xl"></i>
    50	                    <span>ã‚«ãƒ¡ãƒ©ã§æ’®å½±</span>
    51	                </button>
    52	                <button id="gallery-btn" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg transition-colors font-medium flex items-center justify-center space-x-2">
    53	                    <i class="fas fa-images text-xl"></i>
    54	                    <span>å†™çœŸã‚’é¸æŠ</span>
    55	                </button>
    56	            </div>
    57	            
    58	            <!-- PCç”¨ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ -->
    59	            <div id="upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-colors">
    60	                <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
    61	                <p class="text-base text-gray-600 mb-2">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã‚¯ãƒªãƒƒã‚¯</p>
    62	                <p class="text-sm text-gray-500">å¯¾å¿œå½¢å¼: PDF, PNG, JPG, JPEG</p>
    63	            </div>
    64	            
    65	            <!-- éš ã•ã‚ŒãŸå…¥åŠ›è¦ç´  -->
    66	            <input type="file" id="file-input" class="hidden" accept=".pdf,.png,.jpg,.jpeg">
    67	            <input type="file" id="camera-input" class="hidden" accept="image/*" capture="environment">
    68	            <input type="file" id="gallery-input" class="hidden" accept="image/*">
    69	        </div>
    70	
    71	        <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢ -->
    72	        <div id="text-input-area" class="mb-6 hidden">
    73	            <div class="bg-white rounded-lg shadow p-6">
    74	                <label for="text-area" class="block text-lg font-medium text-gray-700 mb-3">
    75	                    <i class="fas fa-keyboard mr-2"></i>è‹±èªãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    76	                </label>
    77	                <textarea 
    78	                    id="text-area" 
    79	                    class="w-full h-40 p-3 border border-gray-300 rounded-md resize-vertical focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
    80	                    placeholder="ã“ã“ã«è‹±èªãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã‹ã€ç›´æ¥å…¥åŠ›ã—ã¦ãã ã•ã„...&#10;&#10;ä¾‹ï¼š&#10;Artificial Intelligence (AI) has become one of the most transformative technologies of our time."
    81	                ></textarea>
    82	                <div class="flex gap-3 mt-4">
    83	                    <button id="process-text-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition-colors font-medium">
    84	                        <i class="fas fa-play mr-2"></i>ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†
    85	                    </button>
    86	                    <button id="clear-text-btn" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-md transition-colors font-medium">
    87	                        <i class="fas fa-trash mr-2"></i>ã‚¯ãƒªã‚¢
    88	                    </button>
    89	                    <button id="sample-text-btn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-md transition-colors font-medium">
    90	                        <i class="fas fa-file-alt mr-2"></i>ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ
    91	                    </button>
    92	                </div>
    93	            </div>
    94	        </div>
    95	
    96	        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    97	        <div id="progress-section" class="mb-6 hidden">
    98	            <div class="bg-white rounded-lg shadow p-6">
    99	                <div class="flex items-center mb-3">
   100	                    <i class="fas fa-cog fa-spin text-blue-500 mr-3"></i>
   101	                    <span id="progress-text" class="text-lg font-medium">å‡¦ç†ä¸­...</span>
   102	                </div>
   103	                <div class="w-full bg-gray-200 rounded-full h-2">
   104	                    <div id="progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
   105	                </div>
   106	            </div>
   107	        </div>
   108	
   109	        <!-- ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
   110	        <div id="text-section" class="hidden">
   111	            <div class="bg-white rounded-lg shadow">
   112	                <div class="p-6 border-b">
   113	                    <div class="flex justify-between items-center">
   114	                        <h2 class="text-xl font-bold text-gray-800">
   115	                            <i class="fas fa-file-text mr-2"></i>æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
   116	                        </h2>
   117	                        <button id="copy-text-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition-colors text-sm font-medium">
   118	                            <i class="fas fa-copy mr-2"></i>ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
   119	                        </button>
   120	                    </div>
   121	                </div>
   122	                <div class="p-6">
   123	                    <div id="extracted-text" class="text-gray-700 leading-relaxed whitespace-pre-wrap"></div>
   124	                </div>
   125	            </div>
   126	        </div>
   127	    </div>
   128	
   129	    <!-- è¾æ›¸ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
   130	    <div id="dictionary-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
   131	        <div class="bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
   132	            <div class="flex justify-between items-center p-6 border-b">
   133	                <h3 id="popup-word" class="text-2xl font-bold text-gray-800"></h3>
   134	                <button id="close-popup" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
   135	            </div>
   136	            <div id="popup-content" class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
   137	                <!-- è¾æ›¸å†…å®¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
   138	            </div>
   139	        </div>
   140	    </div>
   141	
   142	    <script>
   143	        // Gemini API Key - å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
   144	        const GEMINI_API_KEY = 'AIzaSyDmc8isiXiQf9fZaO71l42Fte_2NPZXLG8';
   145	        
   146	        // è¾æ›¸ã‚¢ãƒ—ãƒªã®ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½
   147	        class DictionaryApp {
   148	            constructor() {
   149	                this.currentText = '';
   150	                this.initializeElements();
   151	                this.setupEventListeners();
   152	                
   153	                if (window.pdfjsLib) {
   154	                    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
   155	                }
   156	            }
   157	            
   158	            initializeElements() {
   159	                this.uploadArea = document.getElementById('upload-area');
   160	                this.fileInput = document.getElementById('file-input');
   161	                this.cameraBtn = document.getElementById('camera-btn');
   162	                this.galleryBtn = document.getElementById('gallery-btn');
   163	                this.cameraInput = document.getElementById('camera-input');
   164	                this.galleryInput = document.getElementById('gallery-input');
   165	                this.fileTab = document.getElementById('file-tab');
   166	                this.textTab = document.getElementById('text-tab');
   167	                this.fileInputArea = document.getElementById('file-input-area');
   168	                this.textInputArea = document.getElementById('text-input-area');
   169	                this.textArea = document.getElementById('text-area');
   170	                this.processTextBtn = document.getElementById('process-text-btn');
   171	                this.clearTextBtn = document.getElementById('clear-text-btn');
   172	                this.sampleTextBtn = document.getElementById('sample-text-btn');
   173	                this.progressSection = document.getElementById('progress-section');
   174	                this.progressBar = document.getElementById('progress-bar');
   175	                this.progressText = document.getElementById('progress-text');
   176	                this.textSection = document.getElementById('text-section');
   177	                this.extractedText = document.getElementById('extracted-text');
   178	                this.copyTextBtn = document.getElementById('copy-text-btn');
   179	                this.dictionaryPopup = document.getElementById('dictionary-popup');
   180	                this.popupWord = document.getElementById('popup-word');
   181	                this.popupContent = document.getElementById('popup-content');
   182	                this.closePopup = document.getElementById('close-popup');
   183	            }
   184	
   185	            setupEventListeners() {
   186	                // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
   187	                this.fileTab?.addEventListener('click', () => this.switchToFileMode());
   188	                this.textTab?.addEventListener('click', () => this.switchToTextMode());
   189	                
   190	                // ã‚¹ãƒãƒ›ç”¨ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›
   191	                this.cameraBtn?.addEventListener('click', () => this.openCamera());
   192	                this.galleryBtn?.addEventListener('click', () => this.openGallery());
   193	                this.cameraInput?.addEventListener('change', (e) => this.handleFileSelect(e));
   194	                this.galleryInput?.addEventListener('change', (e) => this.handleFileSelect(e));
   195	                
   196	                // PCç”¨ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›
   197	                this.uploadArea?.addEventListener('click', () => this.fileInput?.click());
   198	                this.fileInput?.addEventListener('change', (e) => this.handleFileSelect(e));
   199	                
   200	                // ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†
   201	                this.processTextBtn?.addEventListener('click', () => this.processInputText());
   202	                this.clearTextBtn?.addEventListener('click', () => this.clearTextArea());
   203	                this.sampleTextBtn?.addEventListener('click', () => this.loadSampleText());
   204	                
   205	                // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
   206	                this.closePopup?.addEventListener('click', () => this.closeDictionaryPopup());
   207	                this.dictionaryPopup?.addEventListener('click', (e) => {
   208	                    if (e.target === this.dictionaryPopup) this.closeDictionaryPopup();
   209	                });
   210	                
   211	                // ESCã‚­ãƒ¼
   212	                document.addEventListener('keydown', (e) => {
   213	                    if (e.key === 'Escape') this.closeDictionaryPopup();
   214	                });
   215	                
   216	                // å˜èªã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ï¼‰
   217	                document.addEventListener('click', (e) => {
   218	                    if (e.target.classList.contains('clickable-word')) {
   219	                        const word = e.target.getAttribute('data-word');
   220	                        if (word) this.showDictionary(word);
   221	                    }
   222	                });
   223	                
   224	                // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
   225	                this.copyTextBtn?.addEventListener('click', () => this.copyToClipboard());
   226	            }
   227	            
   228	            switchToFileMode() {
   229	                this.fileTab.classList.add('border-blue-500', 'text-blue-600', 'bg-blue-50');
   230	                this.fileTab.classList.remove('border-transparent', 'text-gray-500');
   231	                this.textTab.classList.remove('border-blue-500', 'text-blue-600', 'bg-blue-50');
   232	                this.textTab.classList.add('border-transparent', 'text-gray-500');
   233	                this.fileInputArea.classList.remove('hidden');
   234	                this.textInputArea.classList.add('hidden');
   235	            }
   236	            
   237	            switchToTextMode() {
   238	                this.textTab.classList.add('border-blue-500', 'text-blue-600', 'bg-blue-50');
   239	                this.textTab.classList.remove('border-transparent', 'text-gray-500');
   240	                this.fileTab.classList.remove('border-blue-500', 'text-blue-600', 'bg-blue-50');
   241	                this.fileTab.classList.add('border-transparent', 'text-gray-500');
   242	                this.textInputArea.classList.remove('hidden');
   243	                this.fileInputArea.classList.add('hidden');
   244	                setTimeout(() => this.textArea?.focus(), 100);
   245	            }
   246	            
   247	            processInputText() {
   248	                const inputText = this.textArea?.value?.trim();
   249	                if (!inputText) {
   250	                    alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
   251	                    return;
   252	                }
   253	                this.showProgress('ãƒ†ã‚­ã‚¹ãƒˆã‚’å‡¦ç†ä¸­...');
   254	                setTimeout(() => {
   255	                    this.displayExtractedText(inputText);
   256	                }, 500);
   257	            }
   258	            
   259	            clearTextArea() {
   260	                if (this.textArea) {
   261	                    this.textArea.value = '';
   262	                    this.textArea.focus();
   263	                }
   264	                this.textSection?.classList.add('hidden');
   265	                this.currentText = '';
   266	            }
   267	            
   268	            loadSampleText() {
   269	                const sampleText = `Artificial Intelligence (AI) has become one of the most transformative technologies of our time. Machine learning algorithms can analyze vast amounts of data to identify patterns and make predictions. Natural language processing enables computers to understand and generate human language.
   270	
   271	The applications of AI are diverse and growing rapidly. In healthcare, AI helps doctors diagnose diseases more accurately. In transportation, autonomous vehicles use AI to navigate safely. However, the development of AI also raises important ethical questions about privacy, bias, and transparency.`;
   272	
   273	                if (this.textArea) {
   274	                    this.textArea.value = sampleText;
   275	                    if (confirm('ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚ã™ãã«å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ')) {
   276	                        this.processInputText();
   277	                    }
   278	                }
   279	            }
   280	            
   281	            openCamera() {
   282	                this.cameraInput?.click();
   283	            }
   284	            
   285	            openGallery() {
   286	                this.galleryInput?.click();
   287	            }
   288	            
   289	            handleFileSelect(event) {
   290	                const file = event.target.files[0];
   291	                if (!file) return;
   292	                
   293	                this.showProgress('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ä¸­...');
   294	                
   295	                // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯OCRå‡¦ç†ï¼ˆç°¡æ˜“ç‰ˆï¼‰
   296	                if (file.type.startsWith('image/')) {
   297	                    this.processImageFile(file);
   298	                } else {
   299	                    // PDFãƒ•ã‚¡ã‚¤ãƒ«ãªã©
   300	                    alert('ç¾åœ¨ã€ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPNG, JPG, JPEGï¼‰ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚');
   301	                    this.hideProgress();
   302	                }
   303	            }
   304	            
   305	            processImageFile(file) {
   306	                // ç°¡æ˜“OCRå‡¦ç†ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯Tesseract.jsãªã©ã‚’ä½¿ç”¨ï¼‰
   307	                const reader = new FileReader();
   308	                reader.onload = (e) => {
   309	                    // ã“ã“ã§ã¯ç°¡æ˜“çš„ã«ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
   310	                    // å®Ÿéš›ã®å®Ÿè£…ã§ã¯OCRãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
   311	                    setTimeout(() => {
   312	                        const sampleText = "This is a sample text extracted from the image. Machine learning and artificial intelligence are transformative technologies.";
   313	                        this.displayExtractedText(sampleText);
   314	                    }, 2000);
   315	                };
   316	                reader.readAsDataURL(file);
   317	            }
   318	            
   319	            displayExtractedText(text) {
   320	                this.currentText = text;
   321	                const processedText = this.makeWordsClickable(text);
   322	                if (this.extractedText) {
   323	                    this.extractedText.innerHTML = processedText;
   324	                }
   325	                this.textSection?.classList.remove('hidden');
   326	                this.updateProgress(100, 'å®Œäº†ï¼');
   327	                setTimeout(() => this.hideProgress(), 1000);
   328	            }
   329	            
   330	            makeWordsClickable(text) {
   331	                const wordPattern = /\b[a-zA-Z]{2,}\b/g;
   332	                return text.replace(wordPattern, (word) => {
   333	                    return `<span class="clickable-word" data-word="${word.toLowerCase()}">${word}</span>`;
   334	                });
   335	            }
   336	            
   337	            async showDictionary(word) {
   338	                if (!this.dictionaryPopup || !this.popupWord || !this.popupContent) return;
   339	                
   340	                this.popupWord.textContent = word;
   341	                this.popupContent.innerHTML = '<div class="flex justify-center p-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div></div>';
   342	                this.dictionaryPopup.classList.remove('hidden');
   343	                
   344	                try {
   345	                    const prompt = `è‹±å˜èªã€Œ${word}ã€ã®è¾æ›¸æƒ…å ±ã‚’ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
   346	
   347	ç™ºéŸ³è¨˜å·: [IPAç™ºéŸ³è¨˜å·]
   348	
   349	ã€åè©ã€‘ï¼ˆè©²å½“ã™ã‚‹å ´åˆã®ã¿ï¼‰
   350	1. æ„å‘³1ã®æ—¥æœ¬èªè¨³
   351	   ä¾‹æ–‡: English example sentence.
   352	   è¨³: æ—¥æœ¬èªè¨³
   353	
   354	ã€å‹•è©ã€‘ï¼ˆè©²å½“ã™ã‚‹å ´åˆã®ã¿ï¼‰
   355	1. å‹•è©ã®æ„å‘³ã®æ—¥æœ¬èªè¨³
   356	   ä¾‹æ–‡: Verb example sentence.
   357	   è¨³: æ—¥æœ¬èªè¨³
   358	
   359	ã€å½¢å®¹è©ã€‘ï¼ˆè©²å½“ã™ã‚‹å ´åˆã®ã¿ï¼‰
   360	1. å½¢å®¹è©ã®æ„å‘³ã®æ—¥æœ¬èªè¨³
   361	   ä¾‹æ–‡: Adjective example sentence.
   362	   è¨³: æ—¥æœ¬èªè¨³
   363	
   364	èªæº: å˜èªã®èªæº
   365	é¡ç¾©èª: synonym1, synonym2
   366	å¯¾ç¾©èª: antonym1, antonym2
   367	
   368	è¾æ›¸ã‚‰ã—ãç°¡æ½”ã§æ­£ç¢ºãªæƒ…å ±ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`;
   369	
   370	                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`, {
   371	                        method: 'POST',
   372	                        headers: { 'Content-Type': 'application/json' },
   373	                        body: JSON.stringify({
   374	                            contents: [{ parts: [{ text: prompt }] }],
   375	                            generationConfig: {
   376	                                temperature: 0.7,
   377	                                topK: 40,
   378	                                topP: 0.95,
   379	                                maxOutputTokens: 800
   380	                            }
   381	                        })
   382	                    });
   383	                    
   384	                    const data = await response.json();
   385	                    
   386	                    if (data.candidates?.[0]?.content?.parts?.[0]?.text) {
   387	                        this.displayDictionary(data.candidates[0].content.parts[0].text, word);
   388	                    } else {
   389	                        throw new Error('è¾æ›¸æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
   390	                    }
   391	                } catch (error) {
   392	                    this.popupContent.innerHTML = `
   393	                        <div class="text-red-600 p-4">
   394	                            <p>âŒ è¾æ›¸æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p>
   395	                            <p class="text-sm mt-2">${error.message}</p>
   396	                        </div>
   397	                    `;
   398	                }
   399	            }
   400	            
   401	            displayDictionary(dictText, word) {
   402	                const html = `
   403	                    <div class="dictionary-layout space-y-4">
   404	                        <div class="flex items-center justify-between mb-4 pb-3 border-b-2 border-blue-200">
   405	                            <h3 class="text-2xl font-bold text-gray-800">${word}</h3>
   406	                            <button onclick="window.dictionaryApp.speakWord('${word}')" 
   407	                                    class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center space-x-2">
   408	                                <span>ğŸ”Š</span>
   409	                                <span>éŸ³å£°å†ç”Ÿ</span>
   410	                            </button>
   411	                        </div>
   412	                        
   413	                        <div class="dictionary-content">
   414	                            ${this.formatDictionary(dictText)}
   415	                        </div>
   416	                        
   417	                        <div class="bg-gray-100 rounded p-2 mt-4 text-xs text-gray-600">
   418	                            ğŸ¤– Powered by Gemini AI
   419	                        </div>
   420	                    </div>
   421	                `;
   422	                
   423	                this.popupContent.innerHTML = html;
   424	            }
   425	            
   426	            formatDictionary(text) {
   427	                // ç™ºéŸ³è¨˜å·ã®æŠ½å‡º
   428	                let formatted = text.replace(
   429	                    /ç™ºéŸ³è¨˜å·\s*[:ï¼š]?\s*\[([^\]]+)\]/g, 
   430	                    '<div class="pronunciation mb-4 text-center"><span class="text-xl font-mono text-blue-600 bg-blue-50 px-3 py-1 rounded">/$1/</span></div>'
   431	                );
   432	                
   433	                // å“è©ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   434	                formatted = formatted.replace(
   435	                    /ã€([^ã€‘]+)ã€‘/g, 
   436	                    '<div class="pos-header mt-6 mb-3"><span class="inline-block bg-blue-600 text-white px-3 py-1 rounded font-medium text-sm">$1</span></div>'
   437	                );
   438	                
   439	                // å®šç¾©ç•ªå·ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   440	                formatted = formatted.replace(
   441	                    /^(\d+)\.\s*(.+)$/gm, 
   442	                    '<div class="definition flex mb-4"><div class="definition-number mr-4"><span class="inline-flex items-center justify-center w-7 h-7 bg-blue-100 text-blue-600 rounded-full text-sm font-semibold">$1</span></div><div class="definition-content flex-1"><div class="meaning mb-2"><span class="text-gray-900 font-medium">$2</span></div></div></div>'
   443	                );
   444	                
   445	                // ä¾‹æ–‡ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   446	                formatted = formatted.replace(
   447	                    /ä¾‹æ–‡:\s*(.+)/g,
   448	                    '<div class="example bg-gray-50 p-3 rounded-md ml-11 mb-2"><div class="text-gray-700 italic text-sm">$1</div></div>'
   449	                );
   450	                
   451	                // è¨³ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   452	                formatted = formatted.replace(
   453	                    /è¨³:\s*(.+)/g,
   454	                    '<div class="translation ml-11 mb-3"><div class="text-gray-600 text-sm"><span class="text-blue-500">â†’</span> $1</div></div>'
   455	                );
   456	                
   457	                // ãã®ä»–ã®æƒ…å ±
   458	                formatted = formatted.replace(
   459	                    /(èªæº|é¡ç¾©èª|å¯¾ç¾©èª|ã‚³ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³):\s*(.+)/g,
   460	                    '<div class="info-item p-3 bg-gray-50 rounded mb-3"><div class="font-medium text-gray-700 mb-1">$1</div><div class="text-sm text-gray-600">$2</div></div>'
   461	                );
   462	                
   463	                // æ”¹è¡Œã‚’HTMLã«å¤‰æ›
   464	                formatted = formatted.replace(/\n/g, '<br>');
   465	                
   466	                return formatted;
   467	            }
   468	            
   469	            speakWord(word) {
   470	                if ('speechSynthesis' in window) {
   471	                    window.speechSynthesis.cancel();
   472	                    const utterance = new SpeechSynthesisUtterance(word);
   473	                    utterance.lang = 'en-US';
   474	                    utterance.rate = 0.8;
   475	                    window.speechSynthesis.speak(utterance);
   476	                } else {
   477	                    alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°åˆæˆæ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚');
   478	                }
   479	            }
   480	            
   481	            closeDictionaryPopup() {
   482	                this.dictionaryPopup?.classList.add('hidden');
   483	            }
   484	            
   485	            copyToClipboard() {
   486	                if (!this.currentText) return;
   487	                navigator.clipboard.writeText(this.currentText).then(() => {
   488	                    if (this.copyTextBtn) {
   489	                        const originalText = this.copyTextBtn.textContent;
   490	                        this.copyTextBtn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
   491	                        this.copyTextBtn.classList.add('bg-green-500');
   492	                        this.copyTextBtn.classList.remove('bg-blue-500');
   493	                        setTimeout(() => {
   494	                            this.copyTextBtn.textContent = originalText;
   495	                            this.copyTextBtn.classList.remove('bg-green-500');
   496	                            this.copyTextBtn.classList.add('bg-blue-500');
   497	                        }, 2000);
   498	                    }
   499	                });
   500	            }
   501	            
   502	            showProgress(message) {
   503	                this.progressSection?.classList.remove('hidden');
   504	                this.updateProgress(0, message);
   505	            }
   506	            
   507	            updateProgress(percent, message) {
   508	                if (this.progressBar) this.progressBar.style.width = `${percent}%`;
   509	                if (this.progressText) this.progressText.textContent = message;
   510	            }
   511	            
   512	            hideProgress() {
   513	                this.progressSection?.classList.add('hidden');
   514	            }
   515	        }
   516	        
   517	        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
   518	        document.addEventListener('DOMContentLoaded', () => {
   519	            const app = new DictionaryApp();
   520	            window.dictionaryApp = app;
   521	            
   522	            // éŸ³å£°åˆæˆã®åˆæœŸåŒ–
   523	            if ('speechSynthesis' in window) {
   524	                window.speechSynthesis.getVoices();
   525	            }
   526	        });
   527	    </script>
   528	</body>
   529	</html>
